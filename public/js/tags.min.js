var m="is-active",a=["is-active","bg-primary","text-white"],h="data-value",c=class{constructor(t,e={}){this.selectElement=t,this.selectElement.style.display="none",this.placeholder=this.getPlaceholder(),this.allowNew=!!t.dataset.allowNew,this.showAllSuggestions=!!t.dataset.showAllSuggestions,this.badgeStyle=t.dataset.badgeStyle??"primary",this.allowClear=!!t.dataset.allowClear,this.suggestionsThreshold=t.dataset.suggestionsThreshold?parseInt(t.dataset.suggestionsThreshold):1,this.keyboardNavigation=!1,this.clearLabel=e.clearLabel??"Clear",this.searchLabel=e.searchLabel??"Type a value",this.holderElement=document.createElement("div"),this.containerElement=document.createElement("div"),this.dropElement=document.createElement("ul"),this.searchInput=document.createElement("input"),this.holderElement.appendChild(this.containerElement),this.containerElement.appendChild(this.searchInput),this.holderElement.appendChild(this.dropElement),this.selectElement.parentNode.insertBefore(this.holderElement,this.selectElement.nextSibling),this.configureSearchInput(),this.configureHolderElement(),this.configureDropElement(),this.configureContainerElement(),this.buildSuggestions()}static init(t="select[multiple]",e={}){let i=document.querySelectorAll(t);for(let l=0;l<i.length;l++){let s=i[l],r=new c(s,e)}}getPlaceholder(){let t=this.selectElement.querySelector("option");if(!!t){if(!t.value){let e=t.innerText;return t.remove(),e}return this.selectElement.getAttribute("placeholder")?this.selectElement.getAttribute("placeholder"):this.selectElement.getAttribute("data-placeholder")?this.selectElement.getAttribute("data-placeholder"):""}}configureDropElement(){this.dropElement.classList.add("dropdown-menu"),this.dropElement.classList.add("p-0"),this.dropElement.style.maxHeight="280px",this.dropElement.style.overflowY="auto",this.dropElement.addEventListener("mouseenter",t=>{this.keyboardNavigation=!1})}configureHolderElement(){this.holderElement.classList.add("form-control"),this.holderElement.classList.add("dropdown"),this.getBootstrapVersion()===4&&(this.holderElement.style.height="auto")}configureContainerElement(){this.containerElement.addEventListener("click",e=>{this.searchInput.focus()});let t=this.selectElement.querySelectorAll("option[selected]");for(let e=0;e<t.length;e++){let i=t[e];!i.value||this.addItem(i.innerText,i.value)}}configureSearchInput(){let t=this;this.searchInput.type="text",this.searchInput.autocomplete="off",this.searchInput.style.border=0,this.searchInput.style.outline=0,this.searchInput.style.maxWidth="100%",this.searchInput.ariaLabel=this.searchLabel,this.adjustWidth(),this.searchInput.addEventListener("input",e=>{this.adjustWidth(),this.searchInput.value.length>=this.suggestionsThreshold?this.showSuggestions():this.hideSuggestions()}),this.searchInput.addEventListener("focus",e=>{this.searchInput.value.length>=this.suggestionsThreshold&&this.showSuggestions()}),this.searchInput.addEventListener("focusout",e=>{setTimeout(function(){t.hideSuggestions()},100)}),this.searchInput.addEventListener("keydown",e=>{switch(e.keyCode||e.key){case 13:case"Enter":let l=this.getActiveSelection();l?(this.addItem(l.innerText,l.getAttribute(h)),this.resetSearchInput(),this.hideSuggestions(),this.removeActiveSelection()):this.allowNew&&this.addItem(this.searchInput.value,null,!0)&&(this.resetSearchInput(),this.hideSuggestions()),e.preventDefault();break;case 38:case"ArrowUp":e.preventDefault(),this.keyboardNavigation=!0;let s=this.moveSelectionUp();this.searchInput.value.length==0&&this.dropElement.classList.contains("show")&&!s&&this.hideSuggestions();break;case 40:case"ArrowDown":e.preventDefault(),this.keyboardNavigation=!0,this.moveSelectionDown(),this.searchInput.value.length==0&&!this.dropElement.classList.contains("show")&&this.showSuggestions();break;case 8:case"Backspace":this.searchInput.value.length==0&&(this.removeLastItem(),this.adjustWidth(),this.hideSuggestions());break}})}moveSelectionUp(){let t=this.getActiveSelection();if(t){let e=t.parentNode;do e=e.previousSibling;while(e&&e.style.display=="none");return e?(t.classList.remove(...a),e.querySelector("a").classList.add(...a),e.parentNode.scrollTop=e.offsetTop-e.parentNode.offsetTop,e):null}return null}moveSelectionDown(){let t=this.getActiveSelection();if(t){let e=t.parentNode;do e=e.nextSibling;while(e&&e.style.display=="none");return e?(t.classList.remove(...a),e.querySelector("a").classList.add(...a),e.offsetTop>e.parentNode.offsetHeight-e.offsetHeight&&(e.parentNode.scrollTop+=e.offsetHeight),e):null}return null}adjustWidth(){this.searchInput.value?this.searchInput.size=this.searchInput.value.length+1:this.getSelectedValues().length?(this.searchInput.placeholder="",this.searchInput.size=1):(this.searchInput.size=this.placeholder.length,this.searchInput.placeholder=this.placeholder)}buildSuggestions(){let t=this.selectElement.querySelectorAll("option");for(let e=0;e<t.length;e++){let i=t[e];if(!i.getAttribute("value"))continue;let l=document.createElement("li"),s=document.createElement("a");l.append(s),s.classList.add("dropdown-item"),s.setAttribute(h,i.getAttribute("value")),s.setAttribute("href","#"),s.innerText=i.innerText,this.dropElement.appendChild(l),s.addEventListener("mouseenter",r=>{this.keyboardNavigation||(this.removeActiveSelection(),l.querySelector("a").classList.add(...a))}),s.addEventListener("mousemove",r=>{this.keyboardNavigation=!1}),s.addEventListener("click",r=>{r.preventDefault(),this.addItem(s.innerText,s.getAttribute(h)),this.resetSearchInput(),this.hideSuggestions()})}}resetSearchInput(){this.searchInput.value="",this.adjustWidth()}getSelectedValues(){let t=this.selectElement.querySelectorAll("option:checked");return Array.from(t).map(e=>e.value)}showSuggestions(){this.dropElement.classList.contains("show")||this.dropElement.classList.add("show"),this.dropElement.style.left=this.searchInput.offsetLeft+"px";let t=this.searchInput.value.toLocaleLowerCase(),e=this.getSelectedValues(),i=this.dropElement.querySelectorAll("li"),l=!1,s=null,r=!1;for(let n=0;n<i.length;n++){let o=i[n],p=o.innerText.toLocaleLowerCase(),d=o.querySelector("a");if(d.classList.remove(...a),e.indexOf(d.getAttribute(h))!=-1){o.style.display="none";continue}r=!0;let u=t.length===0||p.indexOf(t)!==-1;this.showAllSuggestions||this.suggestionsThreshold===0||u?(o.style.display="list-item",l=!0,!s&&u&&(s=o)):o.style.display="none"}l||this.dropElement.classList.remove("show"),s?(this.holderElement.classList.contains("is-invalid")&&this.holderElement.classList.remove("is-invalid"),s.querySelector("a").classList.add(...a),s.parentNode.scrollTop=s.offsetTop-s.parentNode.offsetTop):!this.allowNew&&!(t.length===0&&!r)&&this.holderElement.classList.add("is-invalid")}hideSuggestions(){this.dropElement.classList.contains("show")&&this.dropElement.classList.remove("show"),this.holderElement.classList.contains("is-invalid")&&this.holderElement.classList.remove("is-invalid")}getActiveSelection(){return this.dropElement.querySelector("a."+m)}removeActiveSelection(){let t=this.getActiveSelection();t&&t.classList.remove(...a)}removeLastItem(){let t=this.containerElement.querySelectorAll("span");if(!t.length)return;let e=t[t.length-1];this.removeItem(e.getAttribute(h))}getBootstrapVersion(){let t=5;return window.jQuery&&$.fn.tooltip!=null&&$.fn.tooltip.Constructor!=null&&(t=parseInt($.fn.tooltip.Constructor.VERSION.charAt(0))),t}addItem(t,e,i=!1){e||(e=t);let l=this.getBootstrapVersion(),s=this.selectElement.querySelector('option[value="'+e+'"]');if(s||(s=Array.from(this.selectElement.querySelectorAll("option")).find(o=>o.textContent==t)),i&&s&&s.getAttribute("selected"))return!1;let r=t,n=document.createElement("span");return n.classList.add("badge"),l===5?(n.classList.add("bg-"+this.badgeStyle),n.classList.add("me-2")):(n.classList.add("badge-"+this.badgeStyle),n.classList.add("mr-2")),n.setAttribute(h,e),this.allowClear&&(r=(l===5?'<button type="button" style="font-size:0.65em" class="me-2 btn-close btn-close-white" aria-label="'+this.clearLabel+'"></button>':'<button type="button" style="font-size:1em;float:left;text-shadow:none;color:currentColor;" class="mr-2 close" aria-label="'+this.clearLabel+'"><span aria-hidden="true">&times;</span></button>')+r),n.innerHTML=r,this.containerElement.insertBefore(n,this.searchInput),this.allowClear&&n.querySelector("button").addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),this.removeItem(e),document.activeElement.blur()}),s?s.setAttribute("selected","selected"):(s=document.createElement("option"),s.value=e,s.innerText=t,s.setAttribute("selected","selected"),this.selectElement.appendChild(s)),!0}removeItem(t){let e=this.containerElement.querySelector("span["+h+'="'+t+'"]');if(!e)return;e.remove();let i=this.selectElement.querySelector('option[value="'+t+'"]');i&&i.removeAttribute("selected")}},f=c;export{f as default};
//# sourceMappingURL=tags.min.js.map
